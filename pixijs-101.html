<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PixiJS 101 | Cubelrti&#39;s Blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.854efcde.css" as="style"><link rel="preload" href="/assets/js/app.f42c0b44.js" as="script"><link rel="preload" href="/assets/js/30.52bb0b17.js" as="script"><link rel="prefetch" href="/assets/js/10.516d8242.js"><link rel="prefetch" href="/assets/js/11.c36dcbcb.js"><link rel="prefetch" href="/assets/js/12.e895b184.js"><link rel="prefetch" href="/assets/js/13.ec7be9a7.js"><link rel="prefetch" href="/assets/js/14.54d29f87.js"><link rel="prefetch" href="/assets/js/15.e407cc44.js"><link rel="prefetch" href="/assets/js/16.db49905b.js"><link rel="prefetch" href="/assets/js/17.736569b1.js"><link rel="prefetch" href="/assets/js/18.1a4266aa.js"><link rel="prefetch" href="/assets/js/19.fab2abb6.js"><link rel="prefetch" href="/assets/js/2.ce88158f.js"><link rel="prefetch" href="/assets/js/20.556d670c.js"><link rel="prefetch" href="/assets/js/21.dc368674.js"><link rel="prefetch" href="/assets/js/22.5febb538.js"><link rel="prefetch" href="/assets/js/23.a8022afa.js"><link rel="prefetch" href="/assets/js/24.12852a72.js"><link rel="prefetch" href="/assets/js/25.5a2f1e7f.js"><link rel="prefetch" href="/assets/js/26.d78beae1.js"><link rel="prefetch" href="/assets/js/27.5cdcdcdf.js"><link rel="prefetch" href="/assets/js/28.4adfd5ba.js"><link rel="prefetch" href="/assets/js/29.a67dfb0b.js"><link rel="prefetch" href="/assets/js/3.2891e7af.js"><link rel="prefetch" href="/assets/js/31.bc58c029.js"><link rel="prefetch" href="/assets/js/32.c32f2855.js"><link rel="prefetch" href="/assets/js/33.353142fa.js"><link rel="prefetch" href="/assets/js/34.37af366f.js"><link rel="prefetch" href="/assets/js/35.9bbb247e.js"><link rel="prefetch" href="/assets/js/36.dcd775a7.js"><link rel="prefetch" href="/assets/js/37.7a866a32.js"><link rel="prefetch" href="/assets/js/38.402538ca.js"><link rel="prefetch" href="/assets/js/39.536dee2f.js"><link rel="prefetch" href="/assets/js/4.079b915f.js"><link rel="prefetch" href="/assets/js/40.53a05fc2.js"><link rel="prefetch" href="/assets/js/41.e99a5f5e.js"><link rel="prefetch" href="/assets/js/42.74be2de5.js"><link rel="prefetch" href="/assets/js/43.6a321652.js"><link rel="prefetch" href="/assets/js/44.254475de.js"><link rel="prefetch" href="/assets/js/45.bea33be6.js"><link rel="prefetch" href="/assets/js/46.c1408df5.js"><link rel="prefetch" href="/assets/js/47.74ba1c55.js"><link rel="prefetch" href="/assets/js/48.91bdc6a5.js"><link rel="prefetch" href="/assets/js/49.b8e75933.js"><link rel="prefetch" href="/assets/js/5.b2c7c0bf.js"><link rel="prefetch" href="/assets/js/50.efea2307.js"><link rel="prefetch" href="/assets/js/51.174b1c37.js"><link rel="prefetch" href="/assets/js/52.fd97caa2.js"><link rel="prefetch" href="/assets/js/6.632b27cc.js"><link rel="prefetch" href="/assets/js/7.b2cab865.js"><link rel="prefetch" href="/assets/js/8.5c5f6195.js"><link rel="prefetch" href="/assets/js/9.ad4020c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.854efcde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cubelrti's Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://cubelrti.github.io/resume/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://cubelrti.github.io/resume/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/async-iteration.html" class="sidebar-link">Async Iteration</a></li><li><a href="/bit-manupulation.html" class="sidebar-link">Bit Manupulation</a></li><li><a href="/css-framework-think.html" class="sidebar-link">CSS Framework Think</a></li><li><a href="/css-scrollbars.html" class="sidebar-link">CSS Scrollbars</a></li><li><a href="/darknet-cv2.html" class="sidebar-link">DarkNet &amp; CV2</a></li><li><a href="/event-emitter.html" class="sidebar-link">Event Emitter</a></li><li><a href="/framework-analysis.html" class="sidebar-link">Framework Analysis</a></li><li><a href="/front-end-design-pattern.html" class="sidebar-link">Front-End Design Patterns</a></li><li><a href="/front-end-interview.html" class="sidebar-link">Front-End Interview</a></li><li><a href="/hairline-css.html" class="sidebar-link">Hairline CSS</a></li><li><a href="/image-orientation.html" class="sidebar-link">Image Orientation</a></li><li><a href="/indexed-db.html" class="sidebar-link">IndexedDB Cheatsheet</a></li><li><a href="/intersection-observer.html" class="sidebar-link">Intersection Observer</a></li><li><a href="/javascript-extend.html" class="sidebar-link">Extend in Javascript</a></li><li><a href="/javascript-trending.html" class="sidebar-link">Javascript Trending</a></li><li><a href="/lambda-functions.html" class="sidebar-link">Lambda Expressions</a></li><li><a href="/lazy-load.html" class="sidebar-link">Lazy Load on Web</a></li><li><a href="/lowdb-101.html" class="sidebar-link">LowDB Code Reading</a></li><li><a href="/material-ripple.html" class="sidebar-link">Material Ripple</a></li><li><a href="/modular-javascript.html" class="sidebar-link">Modular Javascript</a></li><li><a href="/node-reverse-proxy.html" class="sidebar-link">Node Reverse Proxy</a></li><li><a href="/nodejs-data-persistence.html" class="sidebar-link">NodeJS Data Persistence</a></li><li><a href="/npm-security.html" class="sidebar-link">NPM Security</a></li><li><a href="/object-creation.html" class="sidebar-link">Object Prototype Extending</a></li><li><a href="/openapi-cheatsheet.html" class="sidebar-link">OpenAPI Cheatsheet</a></li><li><a href="/overcoming-inituition-in-programming.html" class="sidebar-link">Programming Intuition</a></li><li><a href="/pixijs-101.html" class="active sidebar-link">PixiJS 101</a></li><li><a href="/promise-optimization.html" class="sidebar-link">Promise Optimization</a></li><li><a href="/prototype-review.html" class="sidebar-link">Prototype Review</a></li><li><a href="/python-asyncio.html" class="sidebar-link">Python asyncio</a></li><li><a href="/react-fiber.html" class="sidebar-link">React Fiber</a></li><li><a href="/redux-saga.html" class="sidebar-link">Redux Saga</a></li><li><a href="/rust-101.html" class="sidebar-link">Rust 101</a></li><li><a href="/throttle-and-debounce.html" class="sidebar-link">Throttle and Debounce</a></li><li><a href="/typescript-and-node.html" class="sidebar-link">TypeScript and Node</a></li><li><a href="/typescript-and-react.html" class="sidebar-link">Typescript and React</a></li><li><a href="/undefined-in-javascript.html" class="sidebar-link">Undefined in Javascript</a></li><li><a href="/v8-async.html" class="sidebar-link">V8 Async</a></li><li><a href="/v8-sorting.html" class="sidebar-link">V8 Sorting</a></li><li><a href="/v8-torque.html" class="sidebar-link">V8 Torque</a></li><li><a href="/variable-length-curring.html" class="sidebar-link">Variable Length Curring</a></li><li><a href="/vue-impl-01.html" class="sidebar-link">Vue Implementation 01</a></li><li><a href="/vue-impl-02.html" class="sidebar-link">Vue Implementation 02</a></li><li><a href="/vue-impl-03.html" class="sidebar-link">Vue Implementation 03</a></li><li><a href="/vuex-typescript.html" class="sidebar-link">Vuex Typescript</a></li><li><a href="/webrtc-practice.html" class="sidebar-link">WebRTC Practice</a></li><li><a href="/websocket-practice.html" class="sidebar-link">Websocket Practice</a></li><li><a href="/webworker-caveats.html" class="sidebar-link">WebWorker Caveats</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="pixijs-101"><a href="#pixijs-101" aria-hidden="true" class="header-anchor">#</a> PixiJS 101</h1> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// This examples is hard</span>
<span class="token comment">// To understand it, you have to carefully read all readme`s and other examples of respective plugins</span>
<span class="token comment">// Be ready to study the plugins code. Please use latest version of those libs</span>
<span class="token comment">// Used plugins: pixi-projection, pixi-display</span>
<span class="token comment">// 新建一个PIXI程序</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Application</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  resolution<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  autoStart<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  antialias<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>stage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>display<span class="token punctuation">.</span>Stage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> loader <span class="token operator">=</span> app<span class="token punctuation">.</span>loader<span class="token punctuation">;</span>
loader<span class="token punctuation">.</span>baseUrl <span class="token operator">=</span> <span class="token string">'required/assets/proj'</span><span class="token punctuation">;</span>
<span class="token comment">// 3D摄像机部分</span>
<span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Camera3d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">setPlanes</span><span class="token punctuation">(</span><span class="token number">350</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设定平面，视距。</span>
<span class="token comment">// In this case, 350 is focus distance.</span>
<span class="token comment">// If width of the screen is 700, that means 90 degrees horizontal FOV.</span>
<span class="token comment">// Everything that's behind z &lt; -320 will be cut by near plane, everything that's too far away z &gt; 9650 will be cut too.</span>
camera<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">5.5</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cards <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Container3d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个3D容器</span>
cards<span class="token punctuation">.</span>position3d<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">;</span>
<span class="token comment">// MAKE CARDS LARGER:</span>
cards<span class="token punctuation">.</span>scale3d<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>cards<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> shadowGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>display<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 投影组</span>
<span class="token keyword">var</span> cardsGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>display<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  item<span class="token punctuation">.</span>zOrder <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getDepth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接把深度赋给z轴</span>
  item<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">checkFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Layers are 2d elements but we use them only to show stuff, not to transform items, so its fine :)</span>
<span class="token comment">// 这里直接把阴影组和卡组当做2D对象处理了。当然这样处理结果是他们没有厚度。</span>
camera<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>display<span class="token punctuation">.</span>Layer</span><span class="token punctuation">(</span>shadowGroup<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>display<span class="token punctuation">.</span>Layer</span><span class="token punctuation">(</span>cardsGroup<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//we could also add layers in the stage, but then we'll need extra layer for the text</span>
<span class="token comment">// load assets</span>
loader<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'cards'</span><span class="token punctuation">,</span> <span class="token string">'casino/cards.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'casino/table.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>onAssetsLoaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// blur for shadow. Do not use it in production, bake shadow into the texture!</span>
<span class="token comment">// 这里是模糊效果。模糊效果应该在生产环境中直接渲染到贴图上，这样比较节省性能。</span>
<span class="token keyword">var</span> blurFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>BlurFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
blurFilter<span class="token punctuation">.</span>blur <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
<span class="token comment">// PixiJS特有的“精灵”函数</span>
<span class="token keyword">function</span> <span class="token function">CardSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">PIXI</span><span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Container3d<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tex <span class="token operator">=</span> loader<span class="token punctuation">.</span>resources<span class="token punctuation">[</span><span class="token string">'cards'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textures<span class="token punctuation">;</span>
  <span class="token comment">//shadow will be under card</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span>tex<span class="token punctuation">[</span><span class="token string">'black.png'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>scale3d<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
  <span class="token comment">//TRY IT WITH FILTER:</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token punctuation">[</span>blurFilter<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//all shadows are UNDER all cards</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>parentGroup <span class="token operator">=</span> shadowGroup<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Container3d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//cards are above the shadows</span>
  <span class="token comment">//either they have back, either face</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span>parentGroup <span class="token operator">=</span> cardsGroup<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//construct &quot;inner&quot; from back and face</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>back <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span>tex<span class="token punctuation">[</span><span class="token string">'cover1.png'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>back<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Container3d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>back<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>showCode <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scale3d<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//construct &quot;face&quot; from four sprites</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用Object.create作为继承元素。</span>
CardSprite<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token constant">PIXI</span><span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Container3d<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
CardSprite<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createFace</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> face <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>face<span class="token punctuation">;</span>
  face<span class="token punctuation">.</span><span class="token function">removeChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> tex <span class="token operator">=</span> loader<span class="token punctuation">.</span>resources<span class="token punctuation">[</span><span class="token string">'cards'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textures<span class="token punctuation">;</span>
  <span class="token keyword">var</span> sprite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span>tex<span class="token punctuation">[</span><span class="token string">'white1.png'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sprite2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span><span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sprite3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span><span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sprite4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Sprite3d</span><span class="token punctuation">(</span><span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sprite2<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">;</span>
  sprite2<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span>
  sprite3<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">70</span><span class="token punctuation">;</span>
  sprite3<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  sprite4<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">;</span>
  sprite4<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">;</span>
  sprite<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sprite2<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sprite3<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  face<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>sprite<span class="token punctuation">)</span><span class="token punctuation">;</span>
  face<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>sprite2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  face<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>sprite3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  face<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>sprite4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
CardSprite<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">updateFace</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tex <span class="token operator">=</span> loader<span class="token punctuation">.</span>resources<span class="token punctuation">[</span><span class="token string">'cards'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textures<span class="token punctuation">;</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>showCode <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>showCode<span class="token punctuation">;</span>
  <span class="token keyword">var</span> num <span class="token operator">=</span> code <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> suit <span class="token operator">=</span> code <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> face <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>face<span class="token punctuation">;</span>
  face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture <span class="token operator">=</span>
    num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> tex<span class="token punctuation">[</span><span class="token punctuation">(</span>suit <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_'</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FAIL 1 '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>suit <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_'</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture <span class="token operator">=</span>
    suit <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">?</span> tex<span class="token punctuation">[</span>suit <span class="token operator">+</span> <span class="token string">'_big.png'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FAIL 2'</span><span class="token punctuation">,</span> suit <span class="token operator">+</span> <span class="token string">'_big.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture <span class="token operator">=</span>
    suit <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">?</span> tex<span class="token punctuation">[</span>suit <span class="token operator">+</span> <span class="token string">'_small.png'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>Texture<span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>face<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FAIL 3'</span><span class="token punctuation">,</span> suit <span class="token operator">+</span> <span class="token string">'_small.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
CardSprite<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> inner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">-</span> dt <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y <span class="token operator">+</span> dt <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  inner<span class="token punctuation">.</span>position3d<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>inner<span class="token punctuation">.</span>euler<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>back<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
  <span class="token comment">//assignment is overriden, so its actually calling euler.copy(this.euler)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>euler <span class="token operator">=</span> inner<span class="token punctuation">.</span>euler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
CardSprite<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">checkFace</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> inner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inner<span class="token punctuation">;</span>
  <span class="token keyword">var</span> cc<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inner<span class="token punctuation">.</span><span class="token function">isFrontFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//user sees the back</span>
    cc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//user sees the face</span>
    cc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>showCode <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>back<span class="token punctuation">.</span>renderable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>face<span class="token punctuation">.</span>renderable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>back<span class="token punctuation">.</span>renderable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>face<span class="token punctuation">.</span>renderable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cc <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>showCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showCode <span class="token operator">=</span> cc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">dealHand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cards<span class="token punctuation">.</span><span class="token function">removeChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> card <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CardSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span>position3d<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">56</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">:</span> card <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    card<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span>interactive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cards<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> target <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> suit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span>code <span class="token operator">=</span> suit <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">addText</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> style <span class="token operator">=</span> <span class="token punctuation">{</span>
    font<span class="token punctuation">:</span> <span class="token string">'normal 80px Arial'</span><span class="token punctuation">,</span>
    fill<span class="token punctuation">:</span> <span class="token string">'#f5ffe3'</span><span class="token punctuation">,</span>
    dropShadow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    dropShadowColor<span class="token punctuation">:</span> <span class="token string">'rgba(1, 1, 1, 0.4)'</span><span class="token punctuation">,</span>
    dropShadowDistance<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    wordWrap<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> basicText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>Text3d</span><span class="token punctuation">(</span>txt<span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span>
  basicText<span class="token punctuation">.</span>position3d<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">240</span><span class="token punctuation">;</span>
  basicText<span class="token punctuation">.</span>position3d<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>basicText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onAssetsLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//background must be UNDER camera, it doesnt have z-index or any other bullshit for camera</span>
  app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChildAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Sprite</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>table<span class="token punctuation">.</span>texture<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dealHand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">addText</span><span class="token punctuation">(</span><span class="token string">'Tap on cards'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// start animating</span>
  app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>deltaTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cards<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cards<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>deltaTime <span class="token operator">/</span> <span class="token number">60.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// We are gonna sort and show correct side of card,</span>
  <span class="token comment">// so we need updateTransform BEFORE the sorting will be called.</span>
  <span class="token comment">// otherwise this part will be tardy by one frame</span>
  camera<span class="token punctuation">.</span><span class="token function">updateTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/overcoming-inituition-in-programming.html" class="prev">
          Programming Intuition
        </a></span> <span class="next"><a href="/promise-optimization.html">
          Promise Optimization
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.f42c0b44.js" defer></script><script src="/assets/js/30.52bb0b17.js" defer></script>
  </body>
</html>
