(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{190:function(a,t,s){"use strict";s.r(t);var e=s(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"lowdb-code-reading"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lowdb-code-reading","aria-hidden":"true"}},[a._v("#")]),a._v(" LowDB Code Reading")]),a._v(" "),s("h1",{attrs:{id:"main-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#main-js","aria-hidden":"true"}},[a._v("#")]),a._v(" main.js")]),a._v(" "),s("p",[a._v("主入口点，里面先注册了一个自己的"),s("code",[a._v("Lodash")]),a._v("示例")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create a fresh copy of lodash")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" _ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" lodash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("runInContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" db "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),s("p",[a._v("这里的"),s("code",[a._v("chain")]),a._v("创建了一个空的链式对象，从而让"),s("code",[a._v("db")]),a._v("继承了所有的"),s("code",[a._v("lodash")]),a._v("内置方法。")]),a._v(" "),s("p",[a._v("后面进一步改写了"),s("code",[a._v("_.prototype")]),a._v("，在上面加入了一些"),s("code",[a._v("lowdb")]),a._v("自己的方法，数据库的CRUD等等。")]),a._v(" "),s("h1",{attrs:{id:"adapters-base-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adapters-base-js","aria-hidden":"true"}},[a._v("#")]),a._v(" adapters/Base.js")]),a._v(" "),s("p",[a._v("这些Adapters是用来对接底层数据存储格式的。支持的包括File的Async，Sync，LocalStorage，Memory四种。")]),a._v(" "),s("p",[a._v("里面代码非常短，如下：")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Base")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" defaultValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" serialize "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" stringify"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" deserialize "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("parse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("source "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" source\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("defaultValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" defaultValue\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("serialize "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" serialize\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("deserialize "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" deserialize\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),s("p",[a._v("这里就是注册了一下一个接口（用Javascript的方式）。其实如果是Typescript，就可以直接操"),s("code",[a._v("interface")]),a._v("了，然后让这些Adapter实现这个接口。这里的实现略显Hack了一点。")]),a._v(" "),s("h1",{attrs:{id:"adapters-filesync-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adapters-filesync-js","aria-hidden":"true"}},[a._v("#")]),a._v(" adapters/FileSync.js")]),a._v(" "),s("p",[a._v("没什么好说的，非常暴力的包装，然后用了"),s("code",[a._v("graceful-fs")]),a._v("取代原有的"),s("code",[a._v("fs")]),a._v("。")]),a._v(" "),s("p",[a._v("序列化就是本质的"),s("code",[a._v("JSON.stringnify")]),a._v("和"),s("code",[a._v("JSON.parse")]),a._v("。")]),a._v(" "),s("h1",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("那就是Lodash真好用。")])])}],!1,null,null,null);t.default=n.exports}}]);