<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Modular Javascript | Cubelrti&#39;s Blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.854efcde.css" as="style"><link rel="preload" href="/assets/js/app.f42c0b44.js" as="script"><link rel="preload" href="/assets/js/23.a8022afa.js" as="script"><link rel="prefetch" href="/assets/js/10.516d8242.js"><link rel="prefetch" href="/assets/js/11.c36dcbcb.js"><link rel="prefetch" href="/assets/js/12.e895b184.js"><link rel="prefetch" href="/assets/js/13.ec7be9a7.js"><link rel="prefetch" href="/assets/js/14.54d29f87.js"><link rel="prefetch" href="/assets/js/15.e407cc44.js"><link rel="prefetch" href="/assets/js/16.db49905b.js"><link rel="prefetch" href="/assets/js/17.736569b1.js"><link rel="prefetch" href="/assets/js/18.1a4266aa.js"><link rel="prefetch" href="/assets/js/19.fab2abb6.js"><link rel="prefetch" href="/assets/js/2.ce88158f.js"><link rel="prefetch" href="/assets/js/20.556d670c.js"><link rel="prefetch" href="/assets/js/21.dc368674.js"><link rel="prefetch" href="/assets/js/22.5febb538.js"><link rel="prefetch" href="/assets/js/24.12852a72.js"><link rel="prefetch" href="/assets/js/25.5a2f1e7f.js"><link rel="prefetch" href="/assets/js/26.d78beae1.js"><link rel="prefetch" href="/assets/js/27.5cdcdcdf.js"><link rel="prefetch" href="/assets/js/28.4adfd5ba.js"><link rel="prefetch" href="/assets/js/29.a67dfb0b.js"><link rel="prefetch" href="/assets/js/3.2891e7af.js"><link rel="prefetch" href="/assets/js/30.52bb0b17.js"><link rel="prefetch" href="/assets/js/31.bc58c029.js"><link rel="prefetch" href="/assets/js/32.c32f2855.js"><link rel="prefetch" href="/assets/js/33.353142fa.js"><link rel="prefetch" href="/assets/js/34.37af366f.js"><link rel="prefetch" href="/assets/js/35.9bbb247e.js"><link rel="prefetch" href="/assets/js/36.dcd775a7.js"><link rel="prefetch" href="/assets/js/37.7a866a32.js"><link rel="prefetch" href="/assets/js/38.402538ca.js"><link rel="prefetch" href="/assets/js/39.536dee2f.js"><link rel="prefetch" href="/assets/js/4.079b915f.js"><link rel="prefetch" href="/assets/js/40.53a05fc2.js"><link rel="prefetch" href="/assets/js/41.e99a5f5e.js"><link rel="prefetch" href="/assets/js/42.74be2de5.js"><link rel="prefetch" href="/assets/js/43.6a321652.js"><link rel="prefetch" href="/assets/js/44.254475de.js"><link rel="prefetch" href="/assets/js/45.bea33be6.js"><link rel="prefetch" href="/assets/js/46.c1408df5.js"><link rel="prefetch" href="/assets/js/47.74ba1c55.js"><link rel="prefetch" href="/assets/js/48.91bdc6a5.js"><link rel="prefetch" href="/assets/js/49.b8e75933.js"><link rel="prefetch" href="/assets/js/5.b2c7c0bf.js"><link rel="prefetch" href="/assets/js/50.efea2307.js"><link rel="prefetch" href="/assets/js/51.174b1c37.js"><link rel="prefetch" href="/assets/js/52.fd97caa2.js"><link rel="prefetch" href="/assets/js/6.632b27cc.js"><link rel="prefetch" href="/assets/js/7.b2cab865.js"><link rel="prefetch" href="/assets/js/8.5c5f6195.js"><link rel="prefetch" href="/assets/js/9.ad4020c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.854efcde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cubelrti's Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://cubelrti.github.io/resume/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://cubelrti.github.io/resume/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Resume
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/async-iteration.html" class="sidebar-link">Async Iteration</a></li><li><a href="/bit-manupulation.html" class="sidebar-link">Bit Manupulation</a></li><li><a href="/css-framework-think.html" class="sidebar-link">CSS Framework Think</a></li><li><a href="/css-scrollbars.html" class="sidebar-link">CSS Scrollbars</a></li><li><a href="/darknet-cv2.html" class="sidebar-link">DarkNet &amp; CV2</a></li><li><a href="/event-emitter.html" class="sidebar-link">Event Emitter</a></li><li><a href="/framework-analysis.html" class="sidebar-link">Framework Analysis</a></li><li><a href="/front-end-design-pattern.html" class="sidebar-link">Front-End Design Patterns</a></li><li><a href="/front-end-interview.html" class="sidebar-link">Front-End Interview</a></li><li><a href="/hairline-css.html" class="sidebar-link">Hairline CSS</a></li><li><a href="/image-orientation.html" class="sidebar-link">Image Orientation</a></li><li><a href="/indexed-db.html" class="sidebar-link">IndexedDB Cheatsheet</a></li><li><a href="/intersection-observer.html" class="sidebar-link">Intersection Observer</a></li><li><a href="/javascript-extend.html" class="sidebar-link">Extend in Javascript</a></li><li><a href="/javascript-trending.html" class="sidebar-link">Javascript Trending</a></li><li><a href="/lambda-functions.html" class="sidebar-link">Lambda Expressions</a></li><li><a href="/lazy-load.html" class="sidebar-link">Lazy Load on Web</a></li><li><a href="/lowdb-101.html" class="sidebar-link">LowDB Code Reading</a></li><li><a href="/material-ripple.html" class="sidebar-link">Material Ripple</a></li><li><a href="/modular-javascript.html" class="active sidebar-link">Modular Javascript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modular-javascript.html#回顾历史" class="sidebar-link">回顾历史</a></li></ul></li><li><a href="/node-reverse-proxy.html" class="sidebar-link">Node Reverse Proxy</a></li><li><a href="/nodejs-data-persistence.html" class="sidebar-link">NodeJS Data Persistence</a></li><li><a href="/npm-security.html" class="sidebar-link">NPM Security</a></li><li><a href="/object-creation.html" class="sidebar-link">Object Prototype Extending</a></li><li><a href="/openapi-cheatsheet.html" class="sidebar-link">OpenAPI Cheatsheet</a></li><li><a href="/overcoming-inituition-in-programming.html" class="sidebar-link">Programming Intuition</a></li><li><a href="/pixijs-101.html" class="sidebar-link">PixiJS 101</a></li><li><a href="/promise-optimization.html" class="sidebar-link">Promise Optimization</a></li><li><a href="/prototype-review.html" class="sidebar-link">Prototype Review</a></li><li><a href="/python-asyncio.html" class="sidebar-link">Python asyncio</a></li><li><a href="/react-fiber.html" class="sidebar-link">React Fiber</a></li><li><a href="/redux-saga.html" class="sidebar-link">Redux Saga</a></li><li><a href="/rust-101.html" class="sidebar-link">Rust 101</a></li><li><a href="/throttle-and-debounce.html" class="sidebar-link">Throttle and Debounce</a></li><li><a href="/typescript-and-node.html" class="sidebar-link">TypeScript and Node</a></li><li><a href="/typescript-and-react.html" class="sidebar-link">Typescript and React</a></li><li><a href="/undefined-in-javascript.html" class="sidebar-link">Undefined in Javascript</a></li><li><a href="/v8-async.html" class="sidebar-link">V8 Async</a></li><li><a href="/v8-sorting.html" class="sidebar-link">V8 Sorting</a></li><li><a href="/v8-torque.html" class="sidebar-link">V8 Torque</a></li><li><a href="/variable-length-curring.html" class="sidebar-link">Variable Length Curring</a></li><li><a href="/vue-impl-01.html" class="sidebar-link">Vue Implementation 01</a></li><li><a href="/vue-impl-02.html" class="sidebar-link">Vue Implementation 02</a></li><li><a href="/vue-impl-03.html" class="sidebar-link">Vue Implementation 03</a></li><li><a href="/vuex-typescript.html" class="sidebar-link">Vuex Typescript</a></li><li><a href="/webrtc-practice.html" class="sidebar-link">WebRTC Practice</a></li><li><a href="/websocket-practice.html" class="sidebar-link">Websocket Practice</a></li><li><a href="/webworker-caveats.html" class="sidebar-link">WebWorker Caveats</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="modular-javascript"><a href="#modular-javascript" aria-hidden="true" class="header-anchor">#</a> Modular Javascript</h1> <h2 id="回顾历史"><a href="#回顾历史" aria-hidden="true" class="header-anchor">#</a> 回顾历史</h2> <h3 id="requirejs"><a href="#requirejs" aria-hidden="true" class="header-anchor">#</a> RequireJS</h3> <p>这是AngularJS (Angular 1.x) 时代带来的解决方案。通过<code>define</code>函数，<code>require</code>函数来做到模块化的效果，require的回调函数带入之前的lib作为相应参数。这种思路便是后端常见的<strong>Dependency Injection</strong>的思想。</p> <p>典型的用例给的是<code>mathlib</code>这个远古库。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sum <span class="token comment">// 注意这里一样有“变量提升”和lamda的魔法</span>
  <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'mathlib'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>mathlib<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mathlib<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token comment">// &lt;- 6</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>好处：初步的模块化编程思想，解决了长久一来复杂的包互相引用所带来的问题，也解决了原有思路(<code>&lt;script&gt;</code> + IIFE)引入了很难维护的函数列表的问题。</p> <p>坏处：该模式是<strong>异步</strong>的，对于生产坏境来说，这样的性能开销不可接受。存在100个模块，就意味着100个请求同时并行。API同样也不是非常好理解，用来解决模块化的有着更好的语法，没必要一定包装在一个函数里面，看起来非常奇怪。</p> <p>对于AngularJS v1来说，他引入了一种非常巧妙的模块解决方案，用一定的字符串来parse出依赖项，再使用函数的参数确定依赖项。然而，这种方式在使用UgilifyJS等后处理器的时候会出现很大的问题——使用<strong>字符串</strong>来引用，一旦变量名被修改，很难确定是否还能保持正确的引用。</p> <p>当然，对于这样的一种过度包装的模块化方式，很多人是很难以接受的。大家更愿意是使用上面这种RequireJS来解决问题。事实上，这种使用array来包装的模块化注入有点脱裤子放屁的感觉。</p> <div class="language-js extra-class"><pre class="language-js"><code>
module<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'calculator'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>mathlib<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'calculator'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'mathlib'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>mathlib<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="commonjs"><a href="#commonjs" aria-hidden="true" class="header-anchor">#</a> CommonJS</h3> <p>来到了NodeJS的时代。CommonJS是NodeJS所带来的<strong>标准</strong>模块化实践。</p> <p>Unlike RequireJS or AngularJS, CommonJS was rather strict. In RequireJS and AngularJS you could have many dynamically-defined modules per file, whereas CommonJS had a one-to-one mapping between files and modules. At the same time, RequireJS had several ways of declaring a module and AngularJS had several kinds of factories, services, providers and so on — besides the fact that its dependency injection mechanism was tightly coupled to the AngularJS framework itself. CommonJS, in contrast, had a single way of declaring modules. Any JavaScript file was a module, calling require would load dependencies, and anything assigned to module.exports was its interface. This enabled better tooling and code introspection — making it easier for tools to learn the hierarchy of a CommonJS component system.
Eventually, Browserify was invented as a way of bridging the gap between CommonJS modules for Node.js servers and the browser. Using the browserify command-line interface program and providing it with the path to an entry-point module, one could combine an unthinkable amount of modules into a single browser-ready bundle. The killer feature of CommonJS, the npm package registry, was decisive in aiding its takeover of the module loading ecosystem.</p> <h3 id="es6-import-babel-and-webpack"><a href="#es6-import-babel-and-webpack" aria-hidden="true" class="header-anchor">#</a> ES6, import, Babel and Webpack</h3> <p>In Node.js v8.5.0, ESM support was introduced behind an <code>--experimental-modules</code> flag <code>— provided</code> that we use the .mjs file extension for our modules. Most evergreen browsers already support ESM without flags.
Webpack is a successor to Browserify that largely took over in the role of universal module bundler thanks to a broader set of features. Just like in the case of Babel and ES6, Webpack has long supported ESM with both its static import and export statements as well as the dynamic <code>import()</code> function-like expression. It has made a particularly fruitful adoption of ESM, in no little part thanks to the introduction of a &quot;code-splitting&quot; mechanism[2] whereby it’s able to partition an application into different bundles to improve performance on first load experiences.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/material-ripple.html" class="prev">
          Material Ripple
        </a></span> <span class="next"><a href="/node-reverse-proxy.html">
          Node Reverse Proxy
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.f42c0b44.js" defer></script><script src="/assets/js/23.a8022afa.js" defer></script>
  </body>
</html>
